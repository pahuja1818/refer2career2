<div class="wh-100" style="overflow-y: auto; overflow-x: hidden;">
  <ion-header style="position: fixed; ">
    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-menu-button></ion-menu-button>
      </ion-buttons>
      <ion-title>Applications</ion-title>
    </ion-toolbar>
  </ion-header>
  <div class="w-100 vh-100" *ngIf="!isServiceRunning">
    <div class="p-2 bg-white w-100 vh-100" style="margin-top: 50px !important; overflow-y: auto !important;">
      <h4 class="text-md text-center m-4">{{post.jobPost ? post.jobPost.title : ''}}</h4>
      <div class="row justify-content-center vertical-center mt-5">
        <div class="mr-3 p-2 col-auto text-link" [ngClass]="isApplicationRecieved ? 'active-menu' : ''"
          (click)="changeTopMenu(0)">
          <span class="mr-2">Applications received</span>
          <span class="badge badge-light">{{applicationRecieved}}</span>
        </div>
        <div class="mr-3 p-2 col-auto text-link" (click)="changeTopMenu(1)"
          [ngClass]="isShortlisted ? 'active-menu' : ''">
          <span class="mr-2">Shortlisted</span>
          <span class="badge badge-light">{{totalShortlisted}}</span>
        </div>
        <div class="mr-3 p-2 col-auto text-link" (click)="changeTopMenu(2)" [ngClass]="isHired ? 'active-menu' : ''">
          <span class="mr-2">Hired</span>
          <span class="badge badge-light">{{totalHired}}</span>
        </div>
        <div class="mr-3 p-2 col-auto text-link" (click)="changeTopMenu(3)" [ngClass]="isRejected ? 'active-menu' : ''">
          <span class="mr-2">Rejected</span>
          <span class="badge badge-light">{{totalRejected}}</span>
        </div>
      </div>
      <div class="vertical-center justify-content-end" *ngIf="isApplicationRecieved">
        <button class="btn btn-outline-primary text-sm mr-2" (click)="openFilter(filter)">Add Filter</button>
      </div>
      <div class="row justify-content-center">
        <div class="col-sm-8 my-2">
          <div *ngFor="let data of skillsArray; index as i" class="p-1 px-2 bg-violet vertical-center"
            style="display: inline-block; border-radius: 5px; width: max-content; margin: 3px !important; white-space:nowrap;">
            <span class="text-white mr-3">{{data}}</span>
            <span class="material-icons text-xs text-white text-link pt-1" (click)="removeFromFilter(i)">close</span>
          </div>
          <div class="p-1 px-2 bg-violet vertical-center" *ngIf="minExp"
            style="display: inline-block; border-radius: 5px; width: max-content; margin: 3px !important; white-space:nowrap;">
            <span class="text-white mr-3">Minimum Experience: {{minExp}} Years</span>
            <span class="material-icons text-xs text-white text-link pt-1" (click)="removeExp()">close</span>
          </div>
        </div>
      </div>
      <div class="row justify-content-center bg-white p-2" style="overflow: auto;">
        <div class="m-3 pt-4 col-12 col-sm-8" style="min-width: 350px;" *ngFor="let user of aplications">
          <div class="card box-shadow w-100 h-100 p-3">
            <div class="d-flex justify-content-between vertical-center mb-3">
              <div class="text-left">
                <span class="text-dark text-sm semi-bold d-block">{{user.name}}</span>
              </div>
              <span class="text-xs text-grey">Applied on {{user.appliedOn | date: 'dd MMMM
                yyyy'}}</span>
            </div>
            <div class="row my-3" *ngIf='user.skills'>
              <div class="col-sm-12 row ml-1 vertical-center">
                <div class="col-sm-2 text-left mb-2">
                  Skills :
                </div>
                <div class="col-sm-10 text-left">
                  <span class="col mx-2 px-4 py-2 bg-light-grey" style="border-radius: 10px;"
                    *ngFor="let skill of user.skills">
                    {{skill}}
                  </span>
                </div>
              </div>
            </div>
            <div class="row my-3" *ngIf='user.workExperience'>
              <div class="col-sm-12 d-flex vertical-center">
                <div class="col-sm-2 text-left">
                  Work Experience
                </div>
                <div class="col text-left">
                  <div class="text-left" *ngFor="let exp of user.workExperience">
                    <span class="text-grey text-sm mx-2"><b>Title: </b>{{exp.title}}</span>
                    <span class="text-grey text-sm mx-2"><b>Company: </b>{{exp.companyName}}</span>
                    <span class="text-grey text-sm mx-2"><b></b>{{calculateTotalExp(exp)}}</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="row my-3 ml-1 vertical-center justify-content-start" *ngIf='user.workExperience'>
              <div class="col-sm-5 d-flex justify-content-start" *ngIf="user.basicInfo.mobile">
                <span>Mobile Number: <span class="text-grey">{{user.basicInfo.mobile}}</span>
                </span>
              </div>
              <div class="col-sm-5 d-flex justify-content-start">
                <span *ngIf="user.email">Email: <span class="text-grey">{{user.email}}</span>
                </span>
              </div>
            </div>
            <div class="row my-3" *ngIf='user.resume'>
              <div class="col-sm-12 d-flex justify-content-end">
                <button class="btn btn-primary bg-violet"
                  (click)="seeResume(user.resume, user._id, user.profileViews)">Resume</button>
              </div>
            </div>
            <div class="vertical-center" *ngIf="isApplicationRecieved || isShortlisted">
              <a class="text-primary text-link" *ngIf="isApplicationRecieved"
                (click)="openConfirmModal(confirmModal, user.appliedId, 'Shortlist')">Shortlist
                applicant &nbsp; </a>
              <a class="text-success text-link" *ngIf="isShortlisted"
                (click)="openConfirmModal(confirmModal, user.appliedId, 'Hire')">Hire
                applicant &nbsp; </a>|
              <a class="text-danger text-link" (click)="openConfirmModal(confirmModal, user.appliedId, 'Reject')">
                &nbsp; Reject applicant
              </a>
            </div>
            <div class="vertical-center">
              <span class="text-success" *ngIf="isHired">Hired</span>
              <span class="text-danger" *ngIf="isRejected">Rejected</span>
            </div>
          </div>
        </div>
        <div class="col-sm-8" *ngIf="allReferedProfiles.length > 0">
          <table class="table my-5">
            <thead class="thead-light">
              <tr>
                <th scope="col">#</th>
                <th scope="col">Name</th>
                <th scope="col">Email</th>
                <th scope="col">Resume</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let profile of allReferedProfiles; index as i">
                <th scope="row">{{ i + 1 }}</th>
                <td>{{profile.name}}</td>
                <td>{{profile.email}}</td>
                <td><button class="btn btn-primary px-3 py-1" (click)="openResume(profile.resume)">Open Resume</button>
                </td>

              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <app-not-found *ngIf="aplications.length === 0 && allReferedProfiles.length === 0"></app-not-found>
    </div>
  </div>
</div>
<app-spinner-component *ngIf="isServiceRunning"></app-spinner-component>

<ng-template #filter>
  <div class="row p-0 pl-0 ml-0 vh-100 justify-content-end">
    <div class="col-sm-3 p-0 pl-0 ml-0 h-100 bg-white">
      <div class="p-3 pt-5 h-100">
        <div class="vertical-center justify-content-between mb-5">
          <span class="semi-bold text-md">Filter</span>
          <span class="material-icons text-link text-md bold mr-3" (click)="closeModal()">close</span>
        </div>

        <div class="mr-3 mb-3">
          <label class="text-grey">Skills</label>
          <ng-select placeholder="Select skills" [multiple]="true" [(ngModel)]="skillsArray">
            <ng-option *ngFor="let option of filteredSkills | async" [value]="option">
              {{option}}</ng-option>
          </ng-select>
        </div>
        <div class="mr-3">
          <label class="text-grey">Minimum Experience (in years)</label>
          <input class="form-control" type="number" [(ngModel)]="minExp" placeholder="Enter Experience">
        </div>
      </div>
      <div class="my-3 position-absolute w-100" style="bottom: 0px !important; padding: 0px;">
        <hr class="w-100">
        <div class="vertical-center justify-content-center py-3 mb-5">
          <span class="text-primary text-smd mr-3 text-violet text-link" (click)="clearFilter()">Clear all</span>
          <button class="btn btn-primary bg-violet text-sm" (click)="seeResults()">See Results</button>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #skillModal>
  <div class="bg-white p-3" style="border-radius: 7px;">
    <div class="d-block text-right">
      <span class="material-icons text-grey text-right text-link" (click)="closeModal()">close</span>
    </div>
    <span class="text-grey semi-bold d-block text-center my-2">ADD SKILL</span>
    <div class="row p-0 px-2 m-3">
      <div class="col-sm-12 mt-3">
        <mat-form-field class="p-0 w-100 mat-form-field">
          <mat-label>Skill Name</mat-label>
          <input type="text" placeholder="Ex. JAVA" aria-label="Number" matInput [formControl]="skillName"
            [matAutocomplete]="auto">
          <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete">
            <mat-option *ngFor="let option of filteredSkills | async" [value]="option">
              {{option}}
            </mat-option>
          </mat-autocomplete>
          <mat-error>Enter valid detail</mat-error>
        </mat-form-field>
      </div>
    </div>
    <div class="w-100 d-flex justify-content-end mt-4">
      <button class="btn btn-primary bg-violet py-1 px-2" (click)="addSkill()">ADD SKILL</button>
    </div>
  </div>
</ng-template>

<ng-template #confirmModal>
  <div class="p-3 bg-white" style="border-radius: 10px;">
    <div class="w-100 text-right">
      <span class="material-icons text-link text-smd text-grey bold" (click)="closeModal()">close</span>
    </div>
    <div class="w-100 text-center">
      <span class="text-grey text-slmd">Are you sure, you want to {{confirmModalStatus}} this applicant </span>
    </div>
    <div class="mt-4 vertical-center justify-content-center">
      <button class="btn btn-outline-primary text-sm" *ngIf="confirmModalStatus === 'Shortlist'"
        (click)="shortlistApplicant(curentUserId)">Shortlist</button>
      <button class="btn btn-outline-success text-sm" *ngIf="confirmModalStatus === 'Hire'"
        (click)="hireApplicant(curentUserId)">Hire</button>
      <button class="btn btn-outline-danger text-sm" *ngIf="confirmModalStatus === 'Reject'"
        (click)="rejectApplicant(curentUserId)">Reject</button>
    </div>
  </div>
</ng-template>